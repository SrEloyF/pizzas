{% extends 'panel_admin/admin_base.html' %}

{% block titulo %}Admin - Empleados{% endblock %}

{% block contenido %}

<div class="row h-50 my-3 mx-0">
    <div class="col-lg-9 col-md-8 col-sm-12 mb-3 mb-md-0">
        <div class="box h-100 d-flex flex-column">
            <h3 class="text-center py-3 px-1">Mejor empleado por meses</h3>
            <div id="graficoLinealVentasAnio" class="flex-grow-1"></div>
        </div>
    </div>

    <div class="col-lg-3 col-md-4 col-sm-12">
        <div class="box h-100 d-flex flex-column justify-content-center">
            <h3 class="text-center py-3 px-1">Empleados con más ingresos</h3>

            <div class="flex-grow-1 px-4">
                {% if empleados_mas_ingresos %}
                    {% for empleado in empleados_mas_ingresos %}
                        <div class="d-flex justify-content-between">
                            <h4>{{ empleado.0 }}</h4>
                            <h4>{{ empleado.1 }}</h4>
                        </div>
                        <hr class="m-1">
                    {% endfor %}
                {% else %}
                    <h4 class="text-center">Sin datos</h4>
                {% endif %}
            </div>
        </div>
    </div>

</div>

<div class="row h-50 my-2 mx-0">
    <div class="col-lg-3 col-md-6 col-sm-12">
        <div class="box h-100 d-flex flex-column justify-content-center">
            <h3 class="text-center py-3 px-1">Empleados más eficaces (mins)</h3>

            <div class="flex-grow-1 px-4">
                {% if empleados_mas_eficaces %}
                    {% for empleado in empleados_mas_eficaces %}
                        <div class="d-flex justify-content-between">
                            <h4>{{ empleado.0 }}</h4>
                            <h4>{{ empleado.1 }}</h4>
                        </div>
                        <hr class="m-1">
                    {% endfor %}
                {% else %}
                    <h4 class="text-center">Sin datos</h4>
                {% endif %}
            </div>
        </div>
    </div>

    <!--nuevos box-->
    <div class="col-3 h-100">
        <div class="box h-100 d-flex flex-column">
            <h3 class="text-center py-3 px-1">Estados actuales</h3>
            <div id="graficoCircular" class="flex-grow-1"></div>
        </div>
    </div>

    <div class="col-3 h-100">
        <div class="box h-100 d-flex flex-column">
            <h3 class="text-center py-3 px-1">Ventas promedio por empleado</h3>
            <div class="flex-grow-1 d-flex justify-content-center align-items-center contenedor-texto">
                <p class="color-numero">{{ ventas_promedio_por_empleado }}</p>
            </div>
        </div>
    </div>

    <div class="col-3 h-100">
        <div class="box h-100 d-flex flex-column">
            <h3 class="text-center py-3 px-1">Horas trabajadas por empleado</h3>
            <div class="flex-grow-1 d-flex justify-content-center align-items-center contenedor-texto">
                <p class="color-numero">{{ horas_trabajadas_por_empleado }}</p>
            </div>
        </div>
    </div>
</div>

<script>
    const chartDataVentas = {{ data_empleados_mas_ventas|safe }};
    const chartMeses = {{ meses|safe }};
    const chartDataEstadoEmpleados = {{ estado_empleados|safe }};

    const data = chartDataEstadoEmpleados.map(item => ({
        value: item[1],
        name: item[0]
    }));

    const graficoCircular = echarts.init(document.getElementById('graficoCircular'));

    const optionCircular = {
        tooltip: {
            trigger: 'item',
            formatter: function (params) {
                return `<span style="display:inline-block;width:10px;height:10px;background-color:${params.color};border-radius:50%;margin-right:5px;"></span> ${params.name}: ${params.value} (${params.percent}%)`;
            }
        },
        series: [{
            type: 'pie',
            radius: ['40%', '90%'],
            data: data,
            emphasis: {
                itemStyle: {
                    shadowBlur: 10,
                    shadowOffsetX: 0,
                    shadowColor: 'rgba(0, 0, 0, 0.5)'
                }
            },
            label: {
                show: true,
                formatter: '{b}: {c} ({d}%)'
            },
            labelLine: {
                show: false
            }
        }],
        color: ['#FFD40D', '#D03139']
    };

    graficoCircular.setOption(optionCircular);
</script>



{% endblock %}
